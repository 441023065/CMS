(function(){var t=window.Messenger,n;n=window.Messenger=function(){return n._call.apply(this,arguments)},window.Messenger.noConflict=function(){return window.Messenger=t,n}})(),window.Messenger._=function(){var h;if(window._)return window._;var t=Array.prototype,f=Object.prototype,c=Function.prototype,v=t.push,i=t.slice,y=t.concat,l=f.toString,p=f.hasOwnProperty,e=t.forEach,w=t.map,b=t.reduce,k=t.reduceRight,o=t.filter,d=t.every,g=t.some,nt=t.indexOf,tt=t.lastIndexOf,it=Array.isArray,a=Object.keys,u=c.bind,n={},s={},r=n.each=n.forEach=function(t,i,r){var u,o,f;if(t!=null)if(e&&t.forEach===e)t.forEach(i,r);else if(t.length===+t.length){for(u=0,o=t.length;u<o;u++)if(i.call(r,t[u],u,t)===s)return}else for(f in t)if(n.has(t,f)&&i.call(r,t[f],f,t)===s)return};return n.result=function(t,i){if(t==null)return null;var r=t[i];return n.isFunction(r)?r.call(t):r},n.once=function(n){var i=!1,t;return function(){return i?t:(i=!0,t=n.apply(this,arguments),n=null,t)}},h=0,n.uniqueId=function(n){var t=++h+"";return n?n+t:t},n.filter=n.select=function(n,t,i){var u=[];return n==null?u:o&&n.filter===o?n.filter(t,i):(r(n,function(n,r,f){t.call(i,n,r,f)&&(u[u.length]=n)}),u)},r(["Arguments","Function","String","Number","Date","RegExp"],function(t){n["is"+t]=function(n){return l.call(n)=="[object "+t+"]"}}),n.defaults=function(n){return r(i.call(arguments,1),function(t){if(t)for(var i in t)n[i]==null&&(n[i]=t[i])}),n},n.extend=function(n){return r(i.call(arguments,1),function(t){if(t)for(var i in t)n[i]=t[i]}),n},n.keys=a||function(t){var i,r;if(t!==Object(t))throw new TypeError("Invalid object");i=[];for(r in t)n.has(t,r)&&(i[i.length]=r);return i},n.bind=function(n,t){if(n.bind===u&&u)return u.apply(n,i.call(arguments,1));var r=i.call(arguments,2);return function(){return n.apply(t,r.concat(i.call(arguments)))}},n.isObject=function(n){return n===Object(n)},n}(),window.Messenger.Events=function(){if(window.Backbone&&Backbone.Events)return Backbone.Events;var n=function(){var i=/\s+/,t=function(n,t,r,u){var e,o,f,s;if(!r)return!0;if(typeof r=="object")for(e in r)n[t].apply(n,[e,r[e]].concat(u));else if(i.test(r))for(o=r.split(i),f=0,s=o.length;f<s;f++)n[t].apply(n,[o[f]].concat(u));else return!0},r=function(n,t){var i,r=-1,u=n.length;switch(t.length){case 0:while(++r<u)(i=n[r]).callback.call(i.ctx);return;case 1:while(++r<u)(i=n[r]).callback.call(i.ctx,t[0]);return;case 2:while(++r<u)(i=n[r]).callback.call(i.ctx,t[0],t[1]);return;case 3:while(++r<u)(i=n[r]).callback.call(i.ctx,t[0],t[1],t[2]);return;default:while(++r<u)(i=n[r]).callback.apply(i.ctx,t)}},n={on:function(n,i,r){if(!(t(this,"on",n,[i,r])&&i))return this;this._events||(this._events={});var u=this._events[n]||(this._events[n]=[]);return u.push({callback:i,context:r,ctx:r||this}),this},once:function(n,i,r){if(!(t(this,"once",n,[i,r])&&i))return this;var f=this,u=_.once(function(){f.off(n,u),i.apply(this,arguments)});u._callback=i;this.on(n,u,r);return this},off:function(n,i,r){var o,u,s,h,f,c,e,l;if(!this._events||!t(this,"off",n,[i,r]))return this;if(!n&&!i&&!r)return this._events={},this;for(h=n?[n]:_.keys(this._events),f=0,c=h.length;f<c;f++)if(n=h[f],o=this._events[n]){if(s=[],i||r)for(e=0,l=o.length;e<l;e++)u=o[e],(i&&i!==u.callback&&i!==u.callback._callback||r&&r!==u.context)&&s.push(u);this._events[n]=s}return this},trigger:function(n){var i,u,f;return this._events?(i=Array.prototype.slice.call(arguments,1),!t(this,"trigger",n,i))?this:(u=this._events[n],f=this._events.all,u&&r(u,i),f&&r(f,arguments),this):this},listenTo:function(n,t,i){var r=this._listeners||(this._listeners={}),u=n._listenerId||(n._listenerId=_.uniqueId("l"));r[u]=n;n.on(t,typeof t=="object"?this:i,this);return this},stopListening:function(n,t,i){var r=this._listeners,u;if(r){if(n)n.off(t,typeof t=="object"?this:i,this),t||i||delete r[n._listenerId];else{typeof t=="object"&&(i=this);for(u in r)r[u].off(t,i,this);this._listeners={}}return this}}};return n.bind=n.on,n.unbind=n.off,n};return n()}(),function(){var n,e,o,h,s,t,r,u,c,l,a={}.hasOwnProperty,f=function(n,t){function r(){this.constructor=n}for(var i in t)a.call(t,i)&&(n[i]=t[i]);return r.prototype=t.prototype,n.prototype=new r,n.__super__=t.prototype,n},i=[].slice,v=[].indexOf||function(n){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===n)return t;return-1};n=jQuery,t=t!=null?t:window.Messenger._,h=(c=typeof Backbone!="undefined"&&Backbone!==null?Backbone.Events:void 0)!=null?c:window.Messenger.Events,o=function(){function i(i){n.extend(this,h),t.isObject(i)&&(i.el&&this.setElement(i.el),this.model=i.model),this.initialize.apply(this,arguments)}return i.prototype.setElement=function(t){return this.$el=n(t),this.el=this.$el[0]},i.prototype.delegateEvents=function(n){var s,u,r,e,i,o,f;if(n||(n=t.result(this,"events"))){s=/^(\S+)\s*(.*)$/,this.undelegateEvents(),f=[];for(r in n){if(i=n[r],t.isFunction(i)||(i=this[n[r]]),!i)throw new Error("Method "+n[r]+" does not exist");e=r.match(s),u=e[1],o=e[2],i=t.bind(i,this),u+=".delegateEvents"+this.cid,o===""?f.push(this.$el.on(u,i)):f.push(this.$el.on(u,o,i))}return f}},i.prototype.undelegateEvents=function(){return this.$el.off(".delegateEvents"+this.cid)},i.prototype.remove=function(){return this.undelegateEvents(),this.$el.remove()},i}(),r=function(i){function r(){return r.__super__.constructor.apply(this,arguments)}return f(r,i),r.prototype.defaults={hideAfter:10,scroll:!0},r.prototype.initialize=function(t){return t==null&&(t={}),this.shown=!1,this.rendered=!1,this.messenger=t.messenger,this.options=n.extend({},this.options,t,this.defaults)},r.prototype.show=function(){var n;return this.rendered||this.render(),this.$message.removeClass("messenger-hidden"),n=this.shown,this.shown=!0,n?void 0:this.trigger("show")},r.prototype.hide=function(){var n;if(this.rendered)return this.$message.addClass("messenger-hidden"),n=this.shown,this.shown=!1,n?this.trigger("hide"):void 0},r.prototype.cancel=function(){return this.hide()},r.prototype.update=function(i){var r,u=this;if(t.isString(i)&&(i={message:i}),n.extend(this.options,i),this.lastUpdate=new Date,this.rendered=!1,this.events=(r=this.options.events)!=null?r:{},this.render(),this.actionsToEvents(),this.delegateEvents(),this.checkClickable(),this.options.hideAfter?(this.$message.addClass("messenger-will-hide-after"),this._hideTimeout!=null&&clearTimeout(this._hideTimeout),this._hideTimeout=setTimeout(function(){return u.hide()},this.options.hideAfter*1e3)):this.$message.removeClass("messenger-will-hide-after"),this.options.hideOnNavigate){if(this.$message.addClass("messenger-will-hide-on-navigate"),(typeof Backbone!="undefined"&&Backbone!==null?Backbone.history:void 0)!=null)Backbone.history.on("route",function(){return u.hide()})}else this.$message.removeClass("messenger-will-hide-on-navigate");return this.trigger("update",this)},r.prototype.scrollTo=function(){if(this.options.scroll)return n.scrollTo(this.$el,{duration:400,offset:{left:0,top:-20}})},r.prototype.timeSinceUpdate=function(){return this.lastUpdate?new Date-this.lastUpdate:null},r.prototype.actionsToEvents=function(){var r,n,t,i,u=this;t=this.options.actions,i=[];for(n in t)r=t[n],i.push(this.events['click [data-action="'+n+'"] a']=function(t){return function(i){return i.preventDefault(),i.stopPropagation(),u.trigger("action:"+n,t,i),t.action(i)}}(r));return i},r.prototype.checkClickable=function(){var r,t,i,n;i=this.events,n=[];for(t in i)r=i[t],t==="click"?n.push(this.$message.addClass("messenger-clickable")):n.push(void 0);return n},r.prototype.undelegateEvents=function(){var n;return r.__super__.undelegateEvents.apply(this,arguments),(n=this.$message)!=null?n.removeClass("messenger-clickable"):void 0},r.prototype.parseActions=function(){var f,r,t,i,u,e;r=[],u=this.options.actions;for(i in u)f=u[i],t=n.extend({},f),t.name=i,(e=t.label)==null&&(t.label=i),r.push(t);return r},r.prototype.template=function(t){var i,f,e,o,r,c,s,u,l,h,a=this;for(r=n("<div class='messenger-message message alert "+t.type+" message-"+t.type+" alert-"+t.type+"'>"),t.showCloseButton&&(e=n('<button type="button" class="close" data-dismiss="alert">&times;<\/button>'),e.click(function(){return a.cancel(),!0}),r.append(e)),c=n('<div class="messenger-message-inner">'+t.message+"<\/div>"),r.append(c),t.actions.length&&(f=n('<div class="messenger-actions">')),h=t.actions,u=0,l=h.length;u<l;u++)s=h[u],i=n("<span>"),i.attr("data-action",""+s.name),o=n("<a>"),o.html(s.label),i.append(n('<span class="messenger-phrase">')),i.append(o),f.append(i);return r.append(f),r},r.prototype.render=function(){var t;if(!this.rendered)return this._hasSlot||(this.setElement(this.messenger._reserveMessageSlot(this)),this._hasSlot=!0),t=n.extend({},this.options,{actions:this.parseActions()}),this.$message=n(this.template(t)),this.$el.html(this.$message),this.shown=!0,this.rendered=!0,this.trigger("render")},r}(o),s=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return f(t,n),t.prototype.initialize=function(){return t.__super__.initialize.apply(this,arguments),this._timers={}},t.prototype.cancel=function(){return this.clearTimers(),this.hide(),this._actionInstance!=null&&this._actionInstance.abort!=null?this._actionInstance.abort():void 0},t.prototype.clearTimers=function(){var t,i,n,r;n=this._timers;for(t in n)i=n[t],clearTimeout(i);return this._timers={},(r=this.$message)!=null?r.removeClass("messenger-retry-soon messenger-retry-later"):void 0},t.prototype.render=function(){var i,r,u,n;t.__super__.render.apply(this,arguments),this.clearTimers(),u=this.options.actions,n=[];for(r in u)i=u[r],i.auto?n.push(this.startCountdown(r,i)):n.push(void 0);return n},t.prototype.renderPhrase=function(n,t){return n.phrase.replace("TIME",this.formatTime(t))},t.prototype.formatTime=function(n){var t;return(t=function(n,t){return n=Math.floor(n),n!==1&&(t=t+"s"),"in "+n+" "+t},Math.floor(n)===0)?"now...":n<60?t(n,"second"):(n/=60,n<60)?t(n,"minute"):(n/=60,t(n,"hour"))},t.prototype.startCountdown=function(n,t){var f,i,u,e,r=this;if(this._timers[n]==null)return f=this.$message.find("[data-action='"+n+"'] .messenger-phrase"),i=(e=t.delay)!=null?e:3,i<=10?(this.$message.removeClass("messenger-retry-later"),this.$message.addClass("messenger-retry-soon")):(this.$message.removeClass("messenger-retry-soon"),this.$message.addClass("messenger-retry-later")),u=function(){var e;return f.text(r.renderPhrase(t,i)),i>0?(e=Math.min(i,1),i-=e,r._timers[n]=setTimeout(u,e*1e3)):(r.$message.removeClass("messenger-retry-soon messenger-retry-later"),delete r._timers[n],t.action())},u()},t}(r),u=function(i){function u(){return u.__super__.constructor.apply(this,arguments)}return f(u,i),u.prototype.tagName="ul",u.prototype.className="messenger",u.prototype.messageDefaults={type:"info"},u.prototype.initialize=function(t){return this.options=t!=null?t:{},this.history=[],this.messageDefaults=n.extend({},this.messageDefaults,this.options.messageDefaults)},u.prototype.render=function(){return this.updateMessageSlotClasses()},u.prototype.findById=function(n){return t.filter(this.history,function(t){return t.msg.options.id===n})},u.prototype._reserveMessageSlot=function(t){var i,r,u=this;i=n("<li>"),i.addClass("messenger-message-slot"),this.$el.prepend(i),this.history.push({msg:t,$slot:i}),this._enforceIdConstraint(t);t.on("update",function(){return u._enforceIdConstraint(t)});while(this.options.maxMessages&&this.history.length>this.options.maxMessages)r=this.history.shift(),r.msg.remove(),r.$slot.remove();return i},u.prototype._enforceIdConstraint=function(n){var u,i,f,t,r;if(n.options.id!=null)for(r=this.history,i=0,f=r.length;i<f;i++)if(u=r[i],t=u.msg,t.options.id!=null&&t.options.id===n.options.id&&n!==t){if(n.options.singleton){n.hide();return}t.hide()}},u.prototype.newMessage=function(n){var t,i,u,f,e=this;n==null&&(n={}),n.messenger=this,r=(i=(u=Messenger.themes[(f=n.theme)!=null?f:this.options.theme])!=null?u.Message:void 0)!=null?i:s,t=new r(n);t.on("show",function(){if(n.scrollTo&&e.$el.css("position")!=="fixed")return t.scrollTo()});t.on("hide show render",this.updateMessageSlotClasses,this);return t},u.prototype.updateMessageSlotClasses=function(){var r,t,n,u,i,e,f;for(u=!0,t=null,r=!1,f=this.history,i=0,e=f.length;i<e;i++)n=f[i],n.$slot.removeClass("first last shown"),n.msg.shown&&n.msg.rendered&&(n.$slot.addClass("shown"),r=!0,t=n,u&&(u=!1,n.$slot.addClass("first")));return t!=null&&t.$slot.addClass("last"),this.$el[""+(r?"remove":"add")+"Class"]("messenger-empty")},u.prototype.hideAll=function(){var r,n,u,t,i;for(t=this.history,i=[],n=0,u=t.length;n<u;n++)r=t[n],i.push(r.msg.hide());return i},u.prototype.post=function(i){var r;return t.isString(i)&&(i={message:i}),i=n.extend(!0,{},this.messageDefaults,i),r=this.newMessage(i),r.update(i),r},u}(o),e=function(r){function u(){return u.__super__.constructor.apply(this,arguments)}return f(u,r),u.prototype.doDefaults={progressMessage:null,successMessage:null,errorMessage:"Error connecting to the server.",showSuccessWithoutError:!0,retry:{auto:!0,allow:!0},action:n.ajax},u.prototype.hookBackboneAjax=function(r){var u,f=this;if(r==null&&(r={}),!(window.Backbone!=null))throw"Expected Backbone to be defined";return r=t.defaults(r,{id:"BACKBONE_ACTION",errorMessage:!1,successMessage:"Request completed successfully.",showSuccessWithoutError:!1}),u=function(n){var i;return i=t.extend({},r,n.messenger),f["do"](i,n)},Backbone.ajax!=null?(Backbone.ajax._withoutMessenger&&(Backbone.ajax=Backbone.ajax._withoutMessenger),r.action!=null&&r.action!==this.doDefaults.action||(r.action=Backbone.ajax),u._withoutMessenger=Backbone.ajax,Backbone.ajax=u):Backbone.sync=t.wrap(Backbone.sync,function(){var r,f,t;return t=arguments[0],r=2<=arguments.length?i.call(arguments,1):[],f=n.ajax,n.ajax=u,t.call.apply(t,[this].concat(i.call(r))),n.ajax=f})},u.prototype._getMessage=function(n,t){return n===!1?!1:n===!0||!(n!=null)||typeof n!="string"?t:n},u.prototype._parseEvents=function(n){var f,u,e,t,i,r,o;n==null&&(n={}),i={};for(t in n)e=n[t],u=t.indexOf(" "),r=t.substring(0,u),f=t.substring(u+1),(o=i[r])==null&&(i[r]={}),i[r][f]=e;return i},u.prototype._normalizeResponse=function(){var u,n,f,e,o,r,s;for(f=1<=arguments.length?i.call(arguments,0):[],e=null,o=null,u=null,r=0,s=f.length;r<s;r++)n=f[r],n==="success"||n==="timeout"||n==="abort"?e=n:(n!=null?n.readyState:void 0)!=null&&(n!=null?n.responseText:void 0)!=null?o=n:t.isObject(n)&&(u=n);return[e,u,o]},u.prototype.run=function(){var h,e,l,r,u,f,c,s,a,y,p,o=this;for(r=arguments[0],f=arguments[1],h=3<=arguments.length?i.call(arguments,2):[],f==null&&(f={}),r=n.extend(!0,{},this.messageDefaults,this.doDefaults,r!=null?r:{}),l=this._parseEvents(r.events),u=(y=r.messageInstance)!=null?y:this.newMessage(r),r.id!=null&&(u.options.id=r.id),r.progressMessage!=null&&u.update(n.extend({},r,{message:r.progressMessage,type:"info"})),t.each(["error","success"],function(t){var e,s,c;return((s=f[t])!=null?s._originalHandler:void 0)&&(f[t]=f[t]._originalHandler),e=(c=f[t])!=null?c:function(){},f[t]=function(){var nt,s,y,tt,w,p,c,it,a,rt,b,k,d,g;if(p=1<=arguments.length?i.call(arguments,0):[],a=o._normalizeResponse.apply(o,p),w=a[0],nt=a[1],c=a[2],t!=="success"||u.errorCount!=null||r.showSuccessWithoutError!==!1||(r.successMessage=null),t==="error"&&((rt=r.errorCount)==null&&(r.errorCount=0),r.errorCount+=1),y=o._getMessage(tt=e.apply(null,p),r[t+"Message"]),t==="error"&&((c!=null?c.status:void 0)===0||w==="abort")){u.hide();return}if(t==="error"&&r.ignoredErrorCodes!=null&&(b=c!=null?c.status:void 0,v.call(r.ignoredErrorCodes,b)>=0)){u.hide();return}return s=n.extend({},r,{message:y,type:t,events:(k=l[t])!=null?k:{},hideOnNavigate:t==="success"}),typeof((d=s.retry)!=null?d.allow:void 0)=="number"&&s.retry.allow--,t==="error"&&(c!=null?c.status:void 0)>=500&&((g=s.retry)!=null?g.allow:void 0)?(s.retry.delay==null&&(s.retry.delay=s.errorCount<4?10:300),s.hideAfter&&((it=s._hideAfter)==null&&(s._hideAfter=s.hideAfter),s.hideAfter=s._hideAfter+s.retry.delay),s._retryActions=!0,s.actions={retry:{label:"retry now",phrase:"Retrying TIME",auto:s.retry.auto,delay:s.retry.delay,action:function(){return s.messageInstance=u,setTimeout(function(){return o["do"].apply(o,[s,f].concat(i.call(h)))},0)}},cancel:{action:function(){return u.cancel()}}}):s._retryActions&&(delete s.actions.retry,delete s.actions.cancel,delete r._retryActions),u.update(s),y?(n.globalMessenger(),u.show()):u.hide()},f[t]._originalHandler=e}),u._actionInstance=r.action.apply(r,[f].concat(i.call(h))),c=["done","progress","fail","state","then"],s=0,a=c.length;s<a;s++)e=c[s],u[e]!=null&&delete u[e],u[e]=(p=u._actionInstance)!=null?p[e]:void 0;return u},u.prototype["do"]=u.prototype.run,u.prototype.ajax=function(){var r,t;return t=arguments[0],r=2<=arguments.length?i.call(arguments,1):[],t.action=n.ajax,this.run.apply(this,[t].concat(i.call(r)))},u}(u),n.fn.messenger=function(){var f,s,r,h,o,c,l,a;return r=arguments[0],s=2<=arguments.length?i.call(arguments,1):[],r==null&&(r={}),f=this,r!=null&&t.isString(r)?(a=f.data("messenger"))[r].apply(a,s):(o=r,f.data("messenger")!=null||(u=(c=(l=Messenger.themes[o.theme])!=null?l.Messenger:void 0)!=null?c:e,f.data("messenger",h=new u(n.extend({el:f},o))),h.render()),f.data("messenger"))},window.Messenger._call=function(t){var f,r,a,e,h,c,i,o,s,u,l;if(c={extraClasses:"messenger-fixed messenger-on-top",theme:"future",maxMessages:9,parentLocations:["body"]},t=n.extend(c,n._messengerDefaults,Messenger.options,t),t.theme!=null&&(t.extraClasses+=" messenger-theme-"+t.theme),i=t.instance||Messenger.instance,t.instance==null){for(s=t.parentLocations,r=null,a=null,u=0,l=s.length;u<l;u++)if(o=s[u],r=n(o),r.length){e=o;break}i?n(i._location)!==n(e)&&(i.$el.detach(),r.prepend(i.$el)):(f=n("<ul>"),r.prepend(f),i=f.messenger(t),i._location=e,Messenger.instance=i)}return i._addedClasses!=null&&i.$el.removeClass(i._addedClasses),i.$el.addClass(h=""+i.className+" "+t.extraClasses),i._addedClasses=h,i},n.extend(Messenger,{Message:s,Messenger:e,themes:(l=Messenger.themes)!=null?l:{}}),n.globalMessenger=window.Messenger=Messenger}.call(this);
//@ sourceMappingURL=messenger.min.js.map